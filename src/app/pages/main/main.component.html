<app-default-main-layout>

  <!-- üî• Mensagem de erro -->
  <div *ngIf="errorLoading" class="error-message">
    <p>‚ùå N√£o foi poss√≠vel carregar os produtos. Verifique se o backend est√° online.</p>
  </div>

  <!-- üî• Bot√£o de adicionar -->
  <button (click)="showForm = !showForm" class="add-button">
    {{ showForm ? 'Fechar formul√°rio' : '‚ûï Adicionar Produto' }}
  </button>

  <!-- üî• Formul√°rio de adicionar produto -->
  <div *ngIf="showForm" class="product-form">
    <h3>Adicionar Novo Produto</h3>

    <input type="text" placeholder="Nome" [(ngModel)]="newProduct.name">
    <input type="number" placeholder="Pre√ßo" [(ngModel)]="newProduct.unitPrice">
    <input type="number" placeholder="Quantidade" [(ngModel)]="newProduct.quantity">
    <input type="text" placeholder="Descri√ß√£o" [(ngModel)]="newProduct.description">

    <button (click)="addProduct()">Salvar Produto</button>
  </div>

  <!-- üî• Container de produtos -->
  <div class="product-container">

    <!-- Nenhum produto -->
    <div *ngIf="products.length === 0 && !errorLoading" class="empty-message">
      <p>‚ö†Ô∏è Nenhum produto encontrado no banco de dados.</p>
    </div>

    <!-- üî• Lista dos produtos -->
    <div *ngFor="let product of products" class="product-card">

      <!-- üîß Modo edi√ß√£o -->
      <div *ngIf="editingProductId === product.id; else viewMode">
        <input type="text" [(ngModel)]="editProductData.name" placeholder="Nome">
        <input type="number" [(ngModel)]="editProductData.unitPrice" placeholder="Pre√ßo">
        <input type="number" [(ngModel)]="editProductData.quantity" placeholder="Quantidade">
        <input type="text" [(ngModel)]="editProductData.description" placeholder="Descri√ß√£o">

        <div class="actions">
          <button (click)="saveEdit()" class="save">Salvar</button>
          <button (click)="cancelEdit()" class="cancel">Cancelar</button>
        </div>
      </div>

      <!-- üëÅÔ∏è Modo visual -->
      <ng-template #viewMode>
        <h2>{{ product.name }}</h2>
        <p><strong>Pre√ßo:</strong> R$ {{ product.unitPrice | number:'1.2-2' }}</p>
        <p><strong>Quantidade:</strong> {{ product.quantity }}</p>
        <p><strong>Descri√ß√£o:</strong> {{ product.description || 'Sem descri√ß√£o' }}</p>

        <div class="actions">
          <button (click)="startEdit(product)" class="edit">Editar</button>
          <button (click)="onDelete(product.id)" class="delete">Remover</button>
        </div>
      </ng-template>

    </div>

    <!-- üî• Card exemplo se backend estiver fora -->
    <div *ngIf="errorLoading" class="product-card">
      <h2>Produto Exemplo</h2>
      <p><strong>Pre√ßo:</strong> R$ 0,00</p>
      <p><strong>Quantidade:</strong> 0</p>
      <p><strong>Descri√ß√£o:</strong> Backend offline ‚Äî Dados n√£o carregados.</p>

      <div class="actions">
        <button class="edit">Editar</button>
        <button class="delete">Remover</button>
      </div>
    </div>

  </div>

</app-default-main-layout>
